{"version":3,"file":"fetch-hoc.js","sources":["../src/index.js"],"sourcesContent":["// @flow\nimport React from 'react';\n\nexport default (\n  resource: string | Function,\n  options?: RequestOptions,\n): Function => Component =>\n  class FetchHOC extends React.Component {\n    _isMounted: boolean;\n\n    getUrl = () => {\n      let url = resource;\n      if (typeof resource === 'function') {\n        url = resource(this.props);\n      }\n\n      return url;\n    };\n\n    state = {\n      // Ensure only truthy URLs start off as loading (#3)\n      loading: !!this.getUrl(),\n      success: undefined,\n      error: undefined,\n    };\n\n    prevUrl = this.getUrl();\n\n    componentDidMount = () => {\n      this._isMounted = true;\n      this.fetchData(this.getUrl());\n    };\n\n    componentDidUpdate() {\n      if (typeof resource === 'function' && this.urlHasChanged()) {\n        this.fetchData(this.getUrl());\n      }\n    }\n\n    componentWillUnmount() {\n      this._isMounted = false;\n    }\n\n    fetchData = url => {\n      if (!url) return;\n\n      // About to start fetching, set loading state\n      this.setState(() => ({\n        loading: true,\n        success: undefined,\n        error: undefined,\n        response: undefined,\n      }));\n\n      const init = {\n        credentials: 'same-origin',\n        ...options,\n      };\n\n      let response;\n      fetch(url, init)\n        .then(result => {\n          response = result.clone();\n          return result.text();\n        })\n        .then(data => {\n          try {\n            data = JSON.parse(data);\n          } catch (e) {\n            // Not JSON\n          }\n\n          if (!this._isMounted) return;\n\n          if (response.status >= 400 && response.status <= 599) {\n            this.setState(() => ({\n              data,\n              error: new Error(response.statusText),\n              loading: false,\n              success: false,\n              response,\n            }));\n            return;\n          }\n\n          this.setState(() => ({\n            data,\n            loading: false,\n            success: true,\n            response,\n          }));\n        })\n        .catch(error => {\n          if (!this._isMounted) return;\n\n          this.setState(() => ({\n            error,\n            loading: false,\n            success: false,\n            response,\n          }));\n        });\n    };\n\n    urlHasChanged = () => {\n      if (typeof resource !== 'function') {\n        return this.prevUrl !== resource;\n      }\n\n      const currentUrl = resource(this.props);\n      if (this.prevUrl !== currentUrl) {\n        this.prevUrl = currentUrl;\n        return true;\n      }\n\n      return false;\n    };\n\n    render() {\n      return <Component {...this.props} {...this.state} />;\n    }\n  };\n"],"names":["resource","options","getUrl","url","props","state","undefined","prevUrl","componentDidMount","_isMounted","fetchData","setState","init","response","then","result","clone","text","JSON","parse","data","e","status","Error","statusText","catch","urlHasChanged","currentUrl","componentDidUpdate","componentWillUnmount","render","React","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,aAAe,UACbA,QADa,EAEbC,OAFa;SAGA;;;;;;;;;;;;;2JAIXC,MAJW,GAIF,YAAM;cACTC,MAAMH,QAAV;cACI,OAAOA,QAAP,KAAoB,UAAxB,EAAoC;kBAC5BA,SAAS,MAAKI,KAAd,CAAN;;;iBAGKD,GAAP;SAVS,QAaXE,KAbW,GAaH;;mBAEG,CAAC,CAAC,MAAKH,MAAL,EAFL;mBAGGI,SAHH;iBAICA;SAjBE,QAoBXC,OApBW,GAoBD,MAAKL,MAAL,EApBC,QAsBXM,iBAtBW,GAsBS,YAAM;gBACnBC,UAAL,GAAkB,IAAlB;gBACKC,SAAL,CAAe,MAAKR,MAAL,EAAf;SAxBS,QAqCXQ,SArCW,GAqCC,eAAO;cACb,CAACP,GAAL,EAAU;;;gBAGLQ,QAAL,CAAc;mBAAO;uBACV,IADU;uBAEVL,SAFU;qBAGZA,SAHY;wBAITA;aAJE;WAAd;;cAOMM;yBACS;aACVX,OAFC,CAAN;;cAKIY,iBAAJ;gBACMV,GAAN,EAAWS,IAAX,EACGE,IADH,CACQ,kBAAU;uBACHC,OAAOC,KAAP,EAAX;mBACOD,OAAOE,IAAP,EAAP;WAHJ,EAKGH,IALH,CAKQ,gBAAQ;gBACR;qBACKI,KAAKC,KAAL,CAAWC,IAAX,CAAP;aADF,CAEE,OAAOC,CAAP,EAAU;;;;gBAIR,CAAC,MAAKZ,UAAV,EAAsB;;gBAElBI,SAASS,MAAT,IAAmB,GAAnB,IAA0BT,SAASS,MAAT,IAAmB,GAAjD,EAAsD;oBAC/CX,QAAL,CAAc;uBAAO;4BAAA;yBAEZ,IAAIY,KAAJ,CAAUV,SAASW,UAAnB,CAFY;2BAGV,KAHU;2BAIV,KAJU;;iBAAP;eAAd;;;;kBAUGb,QAAL,CAAc;qBAAO;0BAAA;yBAEV,KAFU;yBAGV,IAHU;;eAAP;aAAd;WAzBJ,EAgCGc,KAhCH,CAgCS,iBAAS;gBACV,CAAC,MAAKhB,UAAV,EAAsB;;kBAEjBE,QAAL,CAAc;qBAAO;4BAAA;yBAEV,KAFU;yBAGV,KAHU;;eAAP;aAAd;WAnCJ;SAtDS,QAkGXe,aAlGW,GAkGK,YAAM;cAChB,OAAO1B,QAAP,KAAoB,UAAxB,EAAoC;mBAC3B,MAAKO,OAAL,KAAiBP,QAAxB;;;cAGI2B,aAAa3B,SAAS,MAAKI,KAAd,CAAnB;cACI,MAAKG,OAAL,KAAiBoB,UAArB,EAAiC;kBAC1BpB,OAAL,GAAeoB,UAAf;mBACO,IAAP;;;iBAGK,KAAP;SA7GS;;;yBA2BXC,kBA3BW,iCA2BU;YACf,OAAO5B,QAAP,KAAoB,UAApB,IAAkC,KAAK0B,aAAL,EAAtC,EAA4D;eACrDhB,SAAL,CAAe,KAAKR,MAAL,EAAf;;OA7BO;;yBAiCX2B,oBAjCW,mCAiCY;aAChBpB,UAAL,GAAkB,KAAlB;OAlCS;;yBAgHXqB,MAhHW,qBAgHF;eACA,oBAAC,SAAD,eAAe,KAAK1B,KAApB,EAA+B,KAAKC,KAApC,EAAP;OAjHS;;;MACU0B,MAAMC,SADhB;GAHA;CAAf;;;;;;;;"}